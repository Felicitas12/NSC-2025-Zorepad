#version 430 core
layout(binding=0)uniform sampler2D srcTexture;uniform vec2 srcResolution,uTexelSizes[6];uniform int mipLevel=1;in vec2 texCoord;layout(location=0)out vec3 downsample;float t(vec3 d){return 1.f/(1.f+dot(vec3(pow(d.x,1./2.2),pow(d.y,1./2.2),pow(d.z,1./2.2)),vec3(.299f,.587f,.114f))*.25f);}void main(){vec2 d=1./srcResolution;vec3 s=texture(srcTexture,vec2(texCoord.x-2*d.x,texCoord.y+2*d.y)).xyz,v=texture(srcTexture,vec2(texCoord.x,texCoord.y+2*d.y)).xyz,e=texture(srcTexture,vec2(texCoord.x+2*d.x,texCoord.y+2*d.y)).xyz,x=texture(srcTexture,vec2(texCoord.x-2*d.x,texCoord.y)).xyz,y=texture(srcTexture,vec2(texCoord)).xyz,f=texture(srcTexture,vec2(texCoord.x+2*d.x,texCoord.y)).xyz,p=texture(srcTexture,vec2(texCoord.x-2*d.x,texCoord.y-2*d.y)).xyz,l=texture(srcTexture,vec2(texCoord.x,texCoord.y-2*d.y)).xyz,g=texture(srcTexture,vec2(texCoord.x+2*d.x,texCoord.y-2*d.y)).xyz,b=texture(srcTexture,vec2(texCoord.x-d.x,texCoord.y+d.y)).xyz,n=texture(srcTexture,vec2(texCoord.x+d.x,texCoord.y+d.y)).xyz,u=texture(srcTexture,vec2(texCoord.x-d.x,texCoord.y-d.y)).xyz,C=texture(srcTexture,vec2(texCoord.x+d.x,texCoord.y-d.y)).xyz,m[5];switch(mipLevel){case 0:m[0]=(s+v+x+y)*.03125f;m[1]=(v+e+y+f)*.03125f;m[2]=(x+y+p+l)*.03125f;m[3]=(y+f+l+g)*.03125f;m[4]=(b+n+u+C)*.125f;m[0]*=t(m[0]);m[1]*=t(m[1]);m[2]*=t(m[2]);m[3]*=t(m[3]);m[4]*=t(m[4]);downsample=m[0]+m[1]+m[2]+m[3]+m[4];downsample=max(downsample,1e-4f);break;default:downsample=y*.125;downsample+=(s+e+p+g)*.03125;downsample+=(v+x+f+l)*.0625;downsample+=(b+n+u+C)*.125;break;}}