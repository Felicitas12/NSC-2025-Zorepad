#version 330 core
out vec2 FragColor;in vec2 TexCoords;float t(uint u){u=u<<16u|u>>16u;u=(u&1431655765u)<<1u|(u&2863311530u)>>1u;u=(u&858993459u)<<2u|(u&3435973836u)>>2u;u=(u&252645135u)<<4u|(u&4042322160u)>>4u;u=(u&16711935u)<<8u|(u&4278255360u)>>8u;return float(u)*.0000000002328306;}vec3 t(vec2 s,float u){u*=u;float v=2.*acos(-1.)*s.x,f=sqrt((1.-s.y)/(1.+(u*u-1.)*s.y));u=sqrt(1.-f*f);vec3 r;r.x=cos(v)*u;r.y=sin(v)*u;r.z=f;vec3 y=normalize(cross(abs(1.)<.999?vec3(0,0,1):vec3(1,0,0),vec3(0,0,1)));r=y*r.x+cross(vec3(0,0,1),y)*r.y+vec3(0,0,1)*r.z;return normalize(r);}float t(float u,float v){v=v*v/2.;return u/(u*(1.-v)+v);}vec2 s(float u,float v){vec3 r;r.x=sqrt(1.-u*u);r.y=0.;r.z=u;float f=0.,y=0.;for(uint m=0u;m<1024u;++m){vec2 x=vec2(float(m)/float(1024u),t(m));vec3 s=t(x,v),d=normalize(2.*dot(r,s)*s-r);float z=max(dot(r,s),0.);if(max(d.z,0.)>0.){float m=t(max(dot(vec3(0,0,1),d),0.),v)*t(max(dot(vec3(0,0,1),r),0.),v),x=m*z/(max(s.z,0.)*u);m=pow(1.-z,5.);f+=(1.-m)*x;y+=m*x;}}f/=float(1024u);y/=float(1024u);return vec2(f,y);}void main(){FragColor=s(TexCoords.x,TexCoords.y);}